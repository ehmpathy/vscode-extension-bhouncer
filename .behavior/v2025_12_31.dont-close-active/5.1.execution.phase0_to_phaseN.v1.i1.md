# execution: dont-close-active

## summary

all 8 roadmap steps completed successfully. implemented per-extension closure policies and keystroke-based activity tracking.

---

## execution log

### step.1: create getExtension utility ✅

**files created:**
- `src/domain.operations/editors/getExtension.ts`
- `src/domain.operations/editors/getExtension.test.ts`

**verification:** `npm run test:unit -- getExtension.test.ts` → 7 tests pass

---

### step.2: create BouncePolicy type ✅

**files created:**
- `src/domain.objects/BouncePolicy.ts`

**verification:** `npx tsc --noEmit` → types check

---

### step.3: create getBouncePolicy operation ✅

**files created:**
- `src/domain.operations/editors/getBouncePolicy.ts`
- `src/domain.operations/editors/getBouncePolicy.test.ts`

**verification:** `npm run test:unit -- getBouncePolicy.test.ts` → 7 tests pass

---

### step.4: add bounceOnByExtension config + getDefaultBounceConfig ✅

**files created:**
- `src/domain.operations/editors/getDefaultBounceConfig.ts`
- `src/domain.operations/editors/getDefaultBounceConfig.test.ts`

**files modified:**
- `package.json` - added `bhouncer.editors.bounceOnByExtension` configuration

**verification:**
- `npm run test:unit -- getDefaultBounceConfig.test.ts` → 4 tests pass
- `npm run build` → success

---

### step.5: update selectTabsToClose with policy-aware logic ✅

**files modified:**
- `src/domain.operations/editors/selectTabsToClose.ts` - added bounceOnByExtension parameter and policy-aware closure logic
- `src/domain.operations/editors/selectTabsToClose.test.ts` - added 8 policy-aware tests

**verification:** `npm run test:unit -- selectTabsToClose.test.ts` → 16 tests pass (8 original + 8 new)

---

### step.6: update pruneEditors to read and pass config ✅

**files modified:**
- `src/domain.operations/editors/pruneEditors.ts` - reads bounceOnByExtension config and passes to selectTabsToClose
- `src/domain.operations/editors/pruneEditors.test.ts` - added 3 policy-aware tests, updated existing tests for config handling

**verification:** `npm run test:unit -- pruneEditors.test.ts` → 13 tests pass

---

### step.7: add keystroke tracking via onDidChangeTextDocument ✅

**files modified:**
- `src/contract/extension.ts` - added `onDidChangeTextDocument` listener for keystroke tracking
- `src/contract/extension.test.ts` - added test for document change listener registration
- `src/.test/mocks/vscode.ts` - added `onDidChangeTextDocument` mock

**verification:** `npm run test:unit -- extension.test.ts` → 6 tests pass

---

### step.8: full test suite verification ✅

**verification:**
- `npm run test:unit` → 144 tests pass (25 test suites)
- `npx tsc --noEmit` → types check successfully
- `npm run build` → builds successfully (185.8kb)

---

## test coverage matrix

| file | test file | tests |
|------|-----------|-------|
| `getExtension.ts` | `getExtension.test.ts` | 7 |
| `BouncePolicy.ts` | (type-only, verified by tsc) | - |
| `getBouncePolicy.ts` | `getBouncePolicy.test.ts` | 7 |
| `getDefaultBounceConfig.ts` | `getDefaultBounceConfig.test.ts` | 4 |
| `selectTabsToClose.ts` | `selectTabsToClose.test.ts` | 16 |
| `pruneEditors.ts` | `pruneEditors.test.ts` | 13 |
| `extension.ts` | `extension.test.ts` | 6 |

---

## blackbox criteria verification

| criteria | status | verification |
|----------|--------|--------------|
| typing resets idle timer | ✅ | `onDidChangeTextDocument` listener in extension.ts |
| .md files only close on tabs limit | ✅ | `selectTabsToClose.test.ts` - TABS_LIMIT policy tests |
| .ts files close on idle OR tabs limit | ✅ | `selectTabsToClose.test.ts` - BOTH policy tests |
| user can override via config | ✅ | `getBouncePolicy.test.ts` - config override tests |
| default config is correct | ✅ | `getDefaultBounceConfig.test.ts` |
| no-extension files use BOTH | ✅ | `getBouncePolicy.test.ts` - empty extension test |

---

## files changed summary

**new files (7):**
- `src/domain.objects/BouncePolicy.ts`
- `src/domain.operations/editors/getExtension.ts`
- `src/domain.operations/editors/getExtension.test.ts`
- `src/domain.operations/editors/getBouncePolicy.ts`
- `src/domain.operations/editors/getBouncePolicy.test.ts`
- `src/domain.operations/editors/getDefaultBounceConfig.ts`
- `src/domain.operations/editors/getDefaultBounceConfig.test.ts`

**modified files (7):**
- `package.json`
- `src/contract/extension.ts`
- `src/contract/extension.test.ts`
- `src/domain.operations/editors/selectTabsToClose.ts`
- `src/domain.operations/editors/selectTabsToClose.test.ts`
- `src/domain.operations/editors/pruneEditors.ts`
- `src/domain.operations/editors/pruneEditors.test.ts`
- `src/.test/mocks/vscode.ts`
